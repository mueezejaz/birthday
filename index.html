<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Realistic Interactive Birthday Cake</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: radial-gradient(ellipse at center, #4c1d95 0%, #1e1b4b 50%, #0f0a2e 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            overflow: hidden;
        }

        .stars {
            position: absolute;
            width: 100%;
            height: 100%;
            background: transparent;
            animation: twinkle 3s infinite;
        }

        @keyframes twinkle {

            0%,
            100% {
                opacity: 0.3;
            }

            50% {
                opacity: 1;
            }
        }

        .container {
            text-align: center;
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(15px);
            border-radius: 25px;
            padding: 40px;
            box-shadow: 0 15px 50px rgba(139, 92, 246, 0.3),
                0 0 100px rgba(79, 70, 229, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.1);
            position: relative;
        }

        canvas {
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.6),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
            background: linear-gradient(135deg, #1e1b4b 0%, #312e81 100%);
        }

        .instructions {
            color: #e0e7ff;
            margin-top: 25px;
            font-size: 20px;
            text-shadow: 0 0 20px rgba(139, 92, 246, 0.8);
            font-weight: 300;
            letter-spacing: 1px;
        }

        .mic-status {
            color: #fbbf24;
            margin-top: 15px;
            font-weight: 600;
            text-shadow: 0 0 15px rgba(251, 191, 36, 0.6);
            font-size: 16px;
        }

        .relight-btn {
            background: linear-gradient(45deg, #f97316, #ea580c);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 30px;
            font-size: 18px;
            cursor: pointer;
            margin-top: 20px;
            transition: all 0.3s ease;
            box-shadow: 0 5px 20px rgba(249, 115, 22, 0.4);
            font-weight: 600;
            letter-spacing: 0.5px;
        }

        .relight-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(249, 115, 22, 0.6);
            background: linear-gradient(45deg, #ea580c, #dc2626);
        }
    </style>
</head>

<body>
    <div class="stars" id="stars"></div>

    <div class="container">
        <canvas id="cakeCanvas" width="700" height="500"></canvas>
        <div class="instructions">
            ‚ú® Blow gently into your microphone to make a wish ‚ú®
        </div>
        <div class="mic-status" id="micStatus">Click to enable microphone magic</div>
        <button class="relight-btn" onclick="relightCandle()">üî• Relight the Magic</button>
    </div>

    <script>
        const canvas = document.getElementById('cakeCanvas');
        const ctx = canvas.getContext('2d');
        const micStatus = document.getElementById('micStatus');

        let candleLit = true;
        let flameAnimation = 0;
        let audioContext;
        let microphone;
        let analyser;
        let dataArray;
        let micEnabled = false;

        // Enhanced animation variables
        let sparkles = [];
        let smoke = [];
        let flameParticles = [];
        let cakeShine = 0;

        // Create stars background
        function createStars() {
            const starsContainer = document.getElementById('stars');
            for (let i = 0; i < 100; i++) {
                const star = document.createElement('div');
                star.style.position = 'absolute';
                star.style.width = Math.random() * 3 + 'px';
                star.style.height = star.style.width;
                star.style.background = '#fbbf24';
                star.style.borderRadius = '50%';
                star.style.left = Math.random() * 100 + '%';
                star.style.top = Math.random() * 100 + '%';
                star.style.boxShadow = `0 0 ${Math.random() * 10 + 5}px #fbbf24`;
                star.style.animation = `twinkle ${Math.random() * 3 + 2}s infinite`;
                starsContainer.appendChild(star);
            }
        }

        class FlameParticle {
            constructor(x, y) {
                this.x = x + (Math.random() - 0.5) * 8;
                this.y = y;
                this.vx = (Math.random() - 0.5) * 0.5;
                this.vy = -Math.random() * 2 - 1;
                this.life = 1;
                this.decay = Math.random() * 0.02 + 0.01;
                this.size = Math.random() * 3 + 1;
                this.color = Math.random() > 0.5 ? '#fbbf24' : '#f59e0b';
            }

            update() {
                this.x += this.vx;
                this.y += this.vy;
                this.vy *= 0.98;
                this.life -= this.decay;
                this.size *= 0.99;
            }

            draw() {
                ctx.save();
                ctx.globalAlpha = this.life;
                ctx.shadowBlur = 10;
                ctx.shadowColor = this.color;
                ctx.fillStyle = this.color;
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                ctx.fill();
                ctx.restore();
            }
        }

        class Smoke {
            constructor(x, y) {
                this.x = x + (Math.random() - 0.5) * 5;
                this.y = y;
                this.vx = (Math.random() - 0.5) * 0.3;
                this.vy = -Math.random() * 0.5 - 0.2;
                this.life = 1;
                this.decay = Math.random() * 0.005 + 0.002;
                this.size = Math.random() * 8 + 3;
            }

            update() {
                this.x += this.vx;
                this.y += this.vy;
                this.vx *= 0.99;
                this.life -= this.decay;
                this.size += 0.1;
            }

            draw() {
                ctx.save();
                ctx.globalAlpha = this.life * 0.3;
                ctx.fillStyle = '#6b7280';
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                ctx.fill();
                ctx.restore();
            }
        }

        class Sparkle {
            constructor(x, y) {
                this.x = x;
                this.y = y;
                this.size = Math.random() * 4 + 2;
                this.speedX = (Math.random() - 0.5) * 3;
                this.speedY = (Math.random() - 0.5) * 3;
                this.rotation = 0;
                this.rotationSpeed = (Math.random() - 0.5) * 0.2;
                this.life = 1;
                this.decay = Math.random() * 0.015 + 0.005;
                this.color = ['#fbbf24', '#f59e0b', '#eab308'][Math.floor(Math.random() * 3)];
            }

            update() {
                this.x += this.speedX;
                this.y += this.speedY;
                this.speedY += 0.1; // gravity
                this.rotation += this.rotationSpeed;
                this.life -= this.decay;
                this.size *= 0.98;
            }

            draw() {
                ctx.save();
                ctx.globalAlpha = this.life;
                ctx.translate(this.x, this.y);
                ctx.rotate(this.rotation);
                ctx.shadowBlur = 15;
                ctx.shadowColor = this.color;
                ctx.fillStyle = this.color;

                // Draw star shape
                ctx.beginPath();
                for (let i = 0; i < 5; i++) {
                    const angle = (i * Math.PI * 2) / 5;
                    const x = Math.cos(angle) * this.size;
                    const y = Math.sin(angle) * this.size;
                    if (i === 0) ctx.moveTo(x, y);
                    else ctx.lineTo(x, y);

                    const innerAngle = ((i + 0.5) * Math.PI * 2) / 5;
                    const innerX = Math.cos(innerAngle) * this.size * 0.5;
                    const innerY = Math.sin(innerAngle) * this.size * 0.5;
                    ctx.lineTo(innerX, innerY);
                }
                ctx.closePath();
                ctx.fill();
                ctx.restore();
            }
        }

        function setupMicrophone() {
            navigator.mediaDevices.getUserMedia({ audio: true })
                .then(stream => {
                    audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    microphone = audioContext.createMediaStreamSource(stream);
                    analyser = audioContext.createAnalyser();
                    analyser.fftSize = 512;
                    analyser.smoothingTimeConstant = 0.3;

                    microphone.connect(analyser);

                    const bufferLength = analyser.frequencyBinCount;
                    dataArray = new Uint8Array(bufferLength);

                    micEnabled = true;
                    micStatus.textContent = "üé§ Microphone ready - make your wish!";
                    micStatus.style.color = "#4ade80";
                })
                .catch(err => {
                    console.error('Error accessing microphone:', err);
                    micStatus.textContent = "‚ùå Microphone magic unavailable";
                    micStatus.style.color = "#ef4444";
                });
        }

        function checkAudioLevel() {
            if (!micEnabled || !analyser) return;

            analyser.getByteFrequencyData(dataArray);

            let sum = 0;
            for (let i = 0; i < dataArray.length; i++) {
                sum += dataArray[i];
            }
            const average = sum / dataArray.length;
            if (average > 45 && candleLit) {
                candleLit = false;
                // Create dramatic sparkle explosion
                for (let i = 0; i < 30; i++) {
                    sparkles.push(new Sparkle(350 + Math.random() * 20, 120 + Math.random() * 20));
                }
                // Add some smoke
                for (let i = 0; i < 10; i++) {
                    smoke.push(new Smoke(350, 105));
                }
            }
        }

        function drawCake() {
            // Clear with gradient background
            const bgGradient = ctx.createRadialGradient(350, 250, 0, 350, 250, 400);
            bgGradient.addColorStop(0, 'rgba(79, 70, 229, 0.3)');
            bgGradient.addColorStop(1, 'rgba(30, 27, 75, 0.8)');
            ctx.fillStyle = bgGradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Add cake plate shadow
            ctx.save();
            ctx.shadowColor = 'rgba(0, 0, 0, 0.4)';
            ctx.shadowBlur = 20;
            ctx.shadowOffsetY = 10;

            // Cake plate
            const plateGradient = ctx.createRadialGradient(350, 380, 0, 350, 380, 200);
            plateGradient.addColorStop(0, '#e5e7eb');
            plateGradient.addColorStop(0.7, '#d1d5db');
            plateGradient.addColorStop(1, '#9ca3af');
            ctx.fillStyle = plateGradient;
            ctx.beginPath();
            ctx.ellipse(350, 380, 180, 20, 0, 0, Math.PI * 2);
            ctx.fill();
            ctx.restore();

            // Bottom cake layer with realistic shading
            const layer1Gradient = ctx.createLinearGradient(0, 280, 0, 360);
            layer1Gradient.addColorStop(0, '#8b5cf6');
            layer1Gradient.addColorStop(0.3, '#7c3aed');
            layer1Gradient.addColorStop(0.7, '#6d28d9');
            layer1Gradient.addColorStop(1, '#5b21b6');

            ctx.fillStyle = layer1Gradient;
            ctx.beginPath();
            ctx.roundRect(200, 280, 300, 80, 15);
            ctx.fill();

            // Add realistic cake texture and highlights
            ctx.strokeStyle = 'rgba(255, 255, 255, 0.2)';
            ctx.lineWidth = 2;
            ctx.stroke();

            // Frosting decorations on bottom layer
            ctx.fillStyle = '#a855f7';
            for (let i = 0; i < 8; i++) {
                const x = 230 + i * 35;
                ctx.beginPath();
                ctx.arc(x, 300, 8, 0, Math.PI * 2);
                ctx.fill();
                // Add frosting highlight
                ctx.fillStyle = 'rgba(255, 255, 255, 0.4)';
                ctx.beginPath();
                ctx.arc(x - 2, 298, 3, 0, Math.PI * 2);
                ctx.fill();
                ctx.fillStyle = '#a855f7';
            }

            // Middle cake layer
            const layer2Gradient = ctx.createLinearGradient(0, 220, 0, 280);
            layer2Gradient.addColorStop(0, '#6366f1');
            layer2Gradient.addColorStop(0.3, '#4f46e5');
            layer2Gradient.addColorStop(0.7, '#4338ca');
            layer2Gradient.addColorStop(1, '#3730a3');

            ctx.fillStyle = layer2Gradient;
            ctx.beginPath();
            ctx.roundRect(225, 220, 250, 60, 12);
            ctx.fill();

            ctx.strokeStyle = 'rgba(255, 255, 255, 0.3)';
            ctx.lineWidth = 1.5;
            ctx.stroke();

            // Middle layer decorative swirls
            ctx.strokeStyle = '#60a5fa';
            ctx.lineWidth = 3;
            ctx.lineCap = 'round';
            ctx.beginPath();
            ctx.moveTo(245, 250);
            for (let i = 0; i < 6; i++) {
                const x = 245 + i * 35;
                ctx.quadraticCurveTo(x + 15, 240, x + 30, 250);
            }
            ctx.stroke();

            // Top cake layer
            const layer3Gradient = ctx.createLinearGradient(0, 160, 0, 220);
            layer3Gradient.addColorStop(0, '#3b82f6');
            layer3Gradient.addColorStop(0.3, '#2563eb');
            layer3Gradient.addColorStop(0.7, '#1d4ed8');
            layer3Gradient.addColorStop(1, '#1e40af');

            ctx.fillStyle = layer3Gradient;
            ctx.beginPath();
            ctx.roundRect(250, 160, 200, 60, 10);
            ctx.fill();

            ctx.strokeStyle = 'rgba(255, 255, 255, 0.4)';
            ctx.lineWidth = 1;
            ctx.stroke();

            // Top layer elegant decoration
            ctx.fillStyle = '#fbbf24';
            ctx.shadowBlur = 10;
            ctx.shadowColor = '#fbbf24';
            for (let i = 0; i < 5; i++) {
                const x = 270 + i * 32;
                ctx.beginPath();
                ctx.arc(x, 190, 6, 0, Math.PI * 2);
                ctx.fill();
                // Add golden highlight
                ctx.fillStyle = 'rgba(255, 255, 255, 0.8)';
                ctx.beginPath();
                ctx.arc(x - 2, 188, 2, 0, Math.PI * 2);
                ctx.fill();
                ctx.fillStyle = '#fbbf24';
            }
            ctx.shadowBlur = 0;

            // Add subtle cake shine effect
            cakeShine += 0.01;
            const shineAlpha = (Math.sin(cakeShine) + 1) * 0.03;
            const shineGradient = ctx.createLinearGradient(200, 160, 500, 160);
            shineGradient.addColorStop(0, `rgba(255, 255, 255, 0)`);
            shineGradient.addColorStop(0.5, `rgba(255, 255, 255, ${shineAlpha})`);
            shineGradient.addColorStop(1, `rgba(255, 255, 255, 0)`);
            ctx.fillStyle = shineGradient;
            ctx.fillRect(200, 160, 300, 200);
        }

        function drawCandle() {
            // Candle shadow
            ctx.save();
            ctx.shadowColor = 'rgba(0, 0, 0, 0.3)';
            ctx.shadowBlur = 8;
            ctx.shadowOffsetX = -3;
            ctx.shadowOffsetY = 5;

            // Realistic candle body with wax texture
            const candleGradient = ctx.createLinearGradient(340, 110, 360, 110);
            candleGradient.addColorStop(0, '#fef3c7');
            candleGradient.addColorStop(0.2, '#fed7aa');
            candleGradient.addColorStop(0.5, '#fbbf24');
            candleGradient.addColorStop(0.8, '#f59e0b');
            candleGradient.addColorStop(1, '#d97706');

            ctx.fillStyle = candleGradient;
            ctx.beginPath();
            ctx.roundRect(340, 110, 20, 50, 3);
            ctx.fill();
            ctx.restore();

            // Candle highlight
            ctx.fillStyle = 'rgba(255, 255, 255, 0.6)';
            ctx.fillRect(342, 115, 3, 40);

            // Melted wax drips
            ctx.fillStyle = '#fbbf24';
            ctx.beginPath();
            ctx.moveTo(340, 135);
            ctx.quadraticCurveTo(335, 140, 338, 145);
            ctx.lineTo(340, 143);
            ctx.closePath();
            ctx.fill();

            ctx.beginPath();
            ctx.moveTo(360, 130);
            ctx.quadraticCurveTo(365, 135, 362, 140);
            ctx.lineTo(360, 138);
            ctx.closePath();
            ctx.fill();

            // Realistic wick
            ctx.fillStyle = '#374151';
            ctx.fillRect(348, 100, 4, 15);

            // Wick tip (burnt)
            ctx.fillStyle = '#1f2937';
            ctx.fillRect(348, 100, 4, 3);

            // Draw flame if candle is lit
            if (candleLit) {
                drawRealisticFlame();
                // Add flame particles
                if (Math.random() < 0.3) {
                    flameParticles.push(new FlameParticle(350, 95));
                }
            } else {
                // Add minimal smoke when extinguished
                if (Math.random() < 0.02) {
                    smoke.push(new Smoke(350, 105));
                }
            }
        }

        function drawRealisticFlame() {
            flameAnimation += 0.15;

            const baseX = 350;
            const baseY = 95;
            const flameHeight = 30 + Math.sin(flameAnimation) * 4;
            const flameWidth = 16 + Math.cos(flameAnimation * 1.2) * 3;
            const sway = Math.sin(flameAnimation * 0.8) * 2;

            // Flame glow effect
            ctx.save();
            ctx.shadowColor = '#fbbf24';
            ctx.shadowBlur = 30;
            ctx.globalAlpha = 0.6;
            ctx.fillStyle = '#fbbf24';
            ctx.beginPath();
            ctx.ellipse(baseX + sway, baseY - 10, flameWidth * 1.5, flameHeight * 1.2, 0, 0, Math.PI * 2);
            ctx.fill();
            ctx.restore();

            // Outer flame (red-orange)
            const outerGradient = ctx.createRadialGradient(baseX + sway, baseY, 0, baseX + sway, baseY - 15, flameHeight);
            outerGradient.addColorStop(0, '#dc2626');
            outerGradient.addColorStop(0.3, '#ea580c');
            outerGradient.addColorStop(0.6, '#f59e0b');
            outerGradient.addColorStop(1, 'rgba(249, 115, 22, 0)');

            ctx.fillStyle = outerGradient;
            ctx.beginPath();
            ctx.moveTo(baseX + sway, baseY);
            ctx.bezierCurveTo(
                baseX + sway - flameWidth / 2, baseY - flameHeight / 3,
                baseX + sway - flameWidth / 3, baseY - flameHeight * 0.8,
                baseX + sway, baseY - flameHeight
            );
            ctx.bezierCurveTo(
                baseX + sway + flameWidth / 3, baseY - flameHeight * 0.8,
                baseX + sway + flameWidth / 2, baseY - flameHeight / 3,
                baseX + sway, baseY
            );
            ctx.closePath();
            ctx.fill();

            // Middle flame (orange-yellow)
            const middleGradient = ctx.createRadialGradient(baseX + sway, baseY - 5, 0, baseX + sway, baseY - 10, flameHeight * 0.8);
            middleGradient.addColorStop(0, '#f59e0b');
            middleGradient.addColorStop(0.4, '#fbbf24');
            middleGradient.addColorStop(1, 'rgba(251, 191, 36, 0)');

            ctx.fillStyle = middleGradient;
            ctx.beginPath();
            ctx.moveTo(baseX + sway, baseY - 2);
            ctx.bezierCurveTo(
                baseX + sway - flameWidth / 3, baseY - flameHeight / 4,
                baseX + sway - flameWidth / 4, baseY - flameHeight * 0.6,
                baseX + sway, baseY - flameHeight * 0.8
            );
            ctx.bezierCurveTo(
                baseX + sway + flameWidth / 4, baseY - flameHeight * 0.6,
                baseX + sway + flameWidth / 3, baseY - flameHeight / 4,
                baseX + sway, baseY - 2
            );
            ctx.closePath();
            ctx.fill();

            // Inner flame (bright yellow)
            const innerGradient = ctx.createRadialGradient(baseX + sway, baseY - 8, 0, baseX + sway, baseY - 5, flameHeight * 0.5);
            innerGradient.addColorStop(0, '#fef3c7');
            innerGradient.addColorStop(0.5, '#fbbf24');
            innerGradient.addColorStop(1, 'rgba(254, 243, 199, 0)');

            ctx.fillStyle = innerGradient;
            ctx.beginPath();
            ctx.moveTo(baseX + sway, baseY - 5);
            ctx.bezierCurveTo(
                baseX + sway - flameWidth / 5, baseY - flameHeight / 5,
                baseX + sway - flameWidth / 6, baseY - flameHeight * 0.4,
                baseX + sway, baseY - flameHeight * 0.5
            );
            ctx.bezierCurveTo(
                baseX + sway + flameWidth / 6, baseY - flameHeight * 0.4,
                baseX + sway + flameWidth / 5, baseY - flameHeight / 5,
                baseX + sway, baseY - 5
            );
            ctx.closePath();
            ctx.fill();

            // Flame core (white-hot center)
            ctx.fillStyle = 'rgba(255, 255, 255, 0.8)';
            ctx.beginPath();
            ctx.ellipse(baseX + sway, baseY - 8, 2, 8, 0, 0, Math.PI * 2);
            ctx.fill();
        }

        function updateParticles() {
            // Update flame particles
            for (let i = flameParticles.length - 1; i >= 0; i--) {
                flameParticles[i].update();
                flameParticles[i].draw();

                if (flameParticles[i].life <= 0) {
                    flameParticles.splice(i, 1);
                }
            }

            // Update smoke
            for (let i = smoke.length - 1; i >= 0; i--) {
                smoke[i].update();
                smoke[i].draw();

                if (smoke[i].life <= 0) {
                    smoke.splice(i, 1);
                }
            }

            // Update sparkles
            for (let i = sparkles.length - 1; i >= 0; i--) {
                sparkles[i].update();
                sparkles[i].draw();

                if (sparkles[i].life <= 0) {
                    sparkles.splice(i, 1);
                }
            }
        }

        function animate() {
            drawCake();
            drawCandle();
            updateParticles();
            checkAudioLevel();
            requestAnimationFrame(animate);
        }

        function relightCandle() {
            candleLit = true;
            sparkles = [];
            smoke = [];
            flameParticles = [];
        }

        // Initialize
        createStars();
        animate();

        // Setup microphone
        canvas.addEventListener('click', () => {
            if (!micEnabled) {
                setupMicrophone();
            }
        });

        document.addEventListener('click', () => {
            if (!micEnabled) {
                setupMicrophone();
            }
        }, { once: true });
    </script>
</body>

</html>